@model BTCPayServer.Models.AppViewModels.ViewPointOfSaleViewModel
@{
    var anyInventoryItems = Model.Items.Any(item => item.Inventory.HasValue);
    int[] CustomTipPercentages = Model.CustomTipPercentages;
}

<script id="template-cart-custom-amount" type="text/template">
    <tr>
        <td colspan="5">
            <div class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fa fa-shopping-cart fa-fw"></i></span>
                </div>
                <input class="js-cart-custom-amount form-control" type="number" min="0" step="@Model.Step" name="amount" placeholder="Pay what you want">
                <div class="input-group-append">
                    <a class="js-cart-custom-amount-remove btn btn-danger" href="#"><i class="fa fa-times"></i></a>
                </div>
            </div>
        </td>
    </tr>
</script>

<script id="template-cart-tip" type="text/template">

</script>




<div class="wrapper" id="app" v-cloak>
    <!-- Page Content  -->
    <div id="content">
        <div class="p-2 p-sm-4">
            <div class="row">
                <div class="col-sm-4 col-lg-2 order-sm-last text-right mb-2">
                    <a class="js-cart btn btn-lg btn-outline-primary" href="#">
                        <i class="fa fa-shopping-basket"></i>&nbsp;
                        <span class="badge badge-light badge-pill">
                            <span id="js-cart-items">{{basketCount}}</span>
                        </span>
                    </a>
                </div>
                <div class="col-sm-8 col-lg-10 mb-2">
                    <div class="mb-2 position-relative">
                        <input type="text" class="js-search form-control form-control-lg" placeholder="Find product" v-model="searchBar">
                        <a class="js-search-reset btn btn-lg btn-link text-black" href="#">
                            <i class="fa fa-times-circle fa-lg"></i>
                        </a>
                    </div>
                </div>
            </div>
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="row">
                    <div class="overflow-hidden col-12">@Safe.Raw(Model.Description)</div>
                </div>
            }
        </div>
        <div id="js-pos-list" class="text-center mx-auto px-4">
            <div class="row card-deck my-3">

                <div class="js-add-cart card my-2 card-wrapper" :data-index="product.index" v-for="product in productsFiltered" v-on:click="addToBasket(product)">

                    <img v-if="product.image !== null && product.image !== ' '" class="card-img-top" :src="product.image" alt="Card image cap">

                    <div class="card-body p-3">
                        <h6 class="card-title mb-0">{{product.title}}</h6>
                        <p v-if="product.description !== null && product.description !== ' '" class="card-text">{{product.description}}</p>
                    </div>
                    <div class="card-footer pt-0 bg-transparent border-0">

                        <span class="text-muted small">{{buttonText(srvModel.buttonText, product.price.formatted)}}</span>
                        <div v-if="product.inventory !== null" class="w-100 pt-2 text-center text-muted">
                            <span>{{getInventoryMessage(product.inventory)}}</span>
                        </div>
                        <div v-else-if="products.filter(item => item.inventory).length > 0" class="w-100 pt-2">&nbsp</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar  -->
    <nav id="sidebar" class="bg-dark">
        <div class="bg-primary p-3 clearfix">
            <h3 class="text-white m-0 pull-left">Cart</h3>
            <a class="js-cart btn btn-sm bg-white text-black pull-right ml-5" href="#">
                <i class="fa fa-times fa-lg"></i>
            </a>
            <a class="js-cart-destroy btn btn-danger pull-right" href="#" v-if="totalBasket > 0" v-on:click="emptyBasket()">Empty cart <i class="fa fa-trash fa-fw fa-lg"></i></a>

        </div>

        <table id="js-cart-list" class="table table-responsive table-light mt-0 mb-0">
            <thead>
                <tr>
                    <th colspan="3" width="55%">Product</th>
                    <th class="text-center" width="20%">
                        <div style="width: 84px">Quantity</div>
                    </th>
                    <th class="text-right" width="25%">
                        <div style="min-width: 50px">Price</div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr :data-id="item.id" v-for="item in basketDisplay">
                    <td class="align-middle pr-0" width="1%"><img :src="item.image" width="50"></td>
                    <td class="align-middle pr-0 pl-2"><b>{{item.title}}</b></td>
                    <td class="align-middle px-0">
                        <a class="js-cart-item-remove btn btn-link" href="#" v-on:click="removeItemFromBasket(item.id)"><i class="fa fa-trash text-muted"></i></a>
                    </td>
                    <td class="align-middle px-0">
                        <div class="input-group align-items-center">
                            <div class="input-group-prepend" v-on:click="removeFromBasket(item)">
                                <a class="js-cart-item-minus btn btn-link px-2" href="#"><i class="fa fa-minus-circle fa-fw text-danger"></i></a>
                            </div>
                            <input class="js-cart-item-count form-control form-control-sm pull-left" type="number" step="1" name="count" placeholder="Qty" :max="item.inventory" :value="item.qty" :data-prev="item.qty">
                            <div class="input-group-append" v-on:click="addToBasket(item)">
                                <a class="js-cart-item-plus btn btn-link px-2" href="#">
                                    <i class="fa fa-plus-circle fa-fw text-success"></i>
                                </a>
                            </div>
                        </div>
                    </td>
                    <td class="align-middle text-right">{{item.price.formatted}}</td>
                </tr>
            </tbody>
        </table>

        <table id="js-cart-extra" class="table table-light mt-0 mb-0">
            <thead>
                @if (Model.ShowCustomAmount)
                {
                    <tr>
                        <th colspan="5" class="border-0 pb-0">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fa fa-shopping-cart fa-fw"></i></span>
                                </div>
                                <input class="js-cart-custom-amount form-control" type="number" min="0" step="@Model.Step" name="amount" v-model="customAmount" placeholder="Pay what you want">
                                <div class="input-group-append">
                                    <a class="js-cart-custom-amount-remove btn btn-danger" href="#" v-on:click="customAmount = ''"><i class="fa fa-times"></i></a>
                                </div>
                            </div>
                        </th>
                    </tr>
                }
                @if (@Model.ShowDiscount)
                {
                    <tr>
                        <th colspan="5" class="border-top-0">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fa fa-percent fa-fw"></i></span>
                                </div>
                                <input class="js-cart-discount form-control" type="number" min="0" step="@Model.Step" v-model="discount" name="discount" placeholder="Discount in %">
                                <div class="input-group-append">
                                    <a class="js-cart-discount-remove btn btn-danger" href="#" v-on:click="discount = ''"><i class="fa fa-times"></i></a>
                                </div>
                            </div>
                        </th>
                    </tr>
                }
                <tr>
                    <th colspan="1" class="pb-4 h4">Total</th>
                    <th colspan="4" class="pb-4 h4 text-right">
                        <span class="js-cart-total">{{totalBasketFormatted}}</span>
                    </th>
                </tr>
            </thead>
        </table>

        <button id="js-cart-confirm" data-toggle="modal" data-target="#cartModal" class="btn btn-primary btn-lg btn-block mb-3 p-3" :disabled="totalBasket === 0" type="submit">
            <b>Confirm</b>
        </button>

        <div class="text-center mb-5 pb-5">
            <img src="~/img/logo.svg" class="logo" height="40">
        </div>
    </nav>

    <div id="cartModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white border-0">
                    <h5 class="modal-title">Confirmation</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">
                            <i class="fa fa-times fa-fw"></i>
                        </span>
                    </button>
                </div>
                <div class="modal-body p-0">
                    <table id="js-cart-summary" class="table m-0">
                        <tbody class="my-3">
                            @if (Model.EnableTips)
                            {
                                <tr>
                                    <th colspan="5" class="border-top-0 pt-4 h5">@Model.CustomTipText</th>
                                </tr>
                                <tr>
                                    <th colspan="5" class="border-0">
                                        <div class="input-group mb-2">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa fa-money fa-fw"></i></span>
                                            </div>
                                            <input class="js-cart-tip form-control form-control-lg" type="number" min="0" step="@Model.Step" v-model="tip" name="tip" placeholder="Tip in @(Model.CurrencyInfo.CurrencySymbol != null ? Model.CurrencyInfo.CurrencySymbol : Model.CurrencyCode)">
                                            <div class="input-group-append">
                                                <a class="js-cart-tip-remove btn btn-lg btn-danger" href="#" v-on:click="tip = ''"><i class="fa fa-times"></i></a>
                                            </div>
                                        </div>
                                        <div class="row mb-1">
                                            @if (CustomTipPercentages != null && CustomTipPercentages.Length > 0)
                                            {
                                                @for (int i = 0; i < CustomTipPercentages.Length; i++)
                                                {
                                                    var percentage = CustomTipPercentages[i];
                                                    <div class="col">
                                                        <a class="js-cart-tip-btn btn btn-lg btn-light btn-block border mb-2" href="#" v-on:click="setTipPercent(@percentage)" data-tip="@percentage">@percentage%</a>
                                                    </div>
                                                }
                                            }

                                        </div>
                                    </th>
                                </tr>
                            }
                            <tr>
                                <td colspan="2" class="border-top-0 h5">Summary</td>
                            </tr>
                            <tr>
                                <td class="border-0 pb-0 h6">Total products</td>
                                <td align="right" class="border-0 pb-0 h6">
                                    <span class="js-cart-summary-products text-nowrap">{{totalProductsFormatted}}</span>
                                </td>
                            </tr>
                            @if (Model.ShowDiscount)
                            {
                                <tr>
                                    <td class="border-0 pb-y h6">Discount</td>
                                    <td align="right" class="border-0 pb-y h6">
                                        <span class="js-cart-summary-discount text-nowrap">{{discountFormatted}}</span>
                                    </td>
                                </tr>
                            }
                            @if (Model.EnableTips)
                            {
                                <tr>
                                    <td class="border-top-0 pt-0 h6">Tip</td>
                                    <td align="right" class="border-top-0 pt-0 h6">
                                        <span class="js-cart-summary-tip text-nowrap">{{tipFormatted}}</span>
                                    </td>
                                </tr>
                            }
                            <tr>
                                <td class="h3 table-light">Total</td>
                                <td class="h3 table-light text-right">
                                    <span class="js-cart-summary-total text-nowrap">{{totalFormatted}}</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer bg-light">
                    <form id="js-cart-pay-form"
                          method="post"
                          asp-controller="AppsPublic"
                          asp-action="ViewPointOfSale"
                          asp-route-appId="@Model.AppId"
                          asp-antiforgery="false"
                          data-buy>
                        <input id="js-cart-amount" class="form-control" type="hidden" name="amount">
                        <input id="js-cart-posdata" class="form-control" type="hidden" name="posdata">
                        <button id="js-cart-pay" class="btn btn-primary btn-lg" type="submit">
                            <b>@Model.CustomButtonText</b>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
